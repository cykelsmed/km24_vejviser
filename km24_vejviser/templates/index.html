<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KM24 Vejviser</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .lead {
            font-size: 1.2rem;
            color: var(--pico-muted-color);
            margin-bottom: 2rem;
        }
        
        .inspiration-container {
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .inspiration-prompt {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
            margin: 0.25rem;
            cursor: pointer;
            background-color: transparent;
            border: 1px solid var(--pico-muted-border-color);
            color: var(--pico-foreground);
            border-radius: 2rem;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        
        .inspiration-prompt:hover {
            background-color: var(--pico-primary);
            color: var(--pico-primary-inverse);
            border-color: var(--pico-primary);
        }
        
        .step {
            border: 1px solid var(--pico-muted-border-color);
            padding: 1rem 1.5rem;
            border-radius: var(--pico-border-radius);
            margin-bottom: 1rem;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .step-number {
            background-color: var(--pico-primary);
            color: var(--pico-primary-inverse);
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }
        
        .step-title {
            margin: 0;
            color: var(--pico-primary);
        }
        
        .search-string-container {
            position: relative;
            background-color: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
        }
        
        .copy-btn.copied {
            background-color: var(--pico-color-success);
            color: var(--pico-color-success-inverse);
        }
        
        .strategic-note, .notification-recommendation {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            background-color: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .strategic-note svg, .notification-recommendation svg {
            width: 1.5rem;
            height: 1.5rem;
            color: var(--pico-color-warning);
            flex-shrink: 0;
            margin-top: 0.1rem;
        }
        
        .validation-warning {
            background-color: var(--pico-color-warning);
            color: var(--pico-color-warning-inverse);
            padding: 1rem;
            border-radius: var(--pico-border-radius);
            margin: 1rem 0;
        }
        
        .km24-suggestions {
            background-color: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .creative-approach, .potential-story-angles, .creative-cross-references {
            background-color: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .creative-insights, .advanced-tactics, .search-examples {
            background-color: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 0.5rem 1rem;
            margin: 0.5rem 0;
        }
        
        .live-data-indicator {
            display: inline-block;
            background-color: var(--pico-color-success);
            color: var(--pico-color-success-inverse);
            padding: 0.2rem 0.5rem;
            border-radius: var(--pico-border-radius);
            font-size: 0.8rem;
            margin: 0.5rem 0;
        }
        
        .live-data-indicator::before {
            content: "‚óè";
            color: #52c41a;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <main class="container">
        <header>
            <h1>KM24 Vejviser</h1>
            <p class="lead">Din guide til datadrevet journalistik</p>
        </header>
        
        <form id="recipe-form">
            <label for="goal">Beskriv dit journalistiske m√•l eller d√¶kningsomr√•de:</label>
            <textarea id="goal" name="goal" rows="5" placeholder="Jeg vil gerne unders√∏ge, hvem der systematisk opk√∏ber ejendomme i Skagen-omr√•det... (minimum 10 tegn)"></textarea>
            
            {% if prompts %}
            <div class="inspiration-container">
                <small>Eller start med et eksempel:</small><br>
                {% for p in prompts %}
                <button type="button" class="inspiration-prompt" data-prompt="{{ p.prompt }}">{{ p.title }}</button>
                {% endfor %}
            </div>
            {% endif %}

            <button type="submit" aria-busy="false">Gener√©r Opskrift</button>
        </form>
        
        <section>
            <h2>Din Opskrift:</h2>
            <div id="result">
                <p>Resultatet af din foresp√∏rgsel vil blive vist her.</p>
            </div>
        </section>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing script');
            
            const form = document.getElementById('recipe-form');
            const resultDiv = document.getElementById('result');
            const goalTextarea = document.getElementById('goal');
            
            console.log('Form found:', form);
            console.log('Result div found:', resultDiv);
            console.log('Goal textarea found:', goalTextarea);
            
            if (!form || !resultDiv || !goalTextarea) {
                console.error('Kritiske elementer mangler!');
                return;
            }
            
            const submitButton = form.querySelector('button[type="submit"]');
            console.log('Submit button found:', submitButton);

            // Form submission handler
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('=== FORM SUBMISSION START ===');
                
                const goal = goalTextarea.value;
                console.log('Goal value:', goal);
                console.log('Goal length:', goal.length);
                
                if (goal.length < 10) {
                    resultDiv.innerHTML = '<p style="color: red;"><strong>Fejl:</strong> Dit m√•l skal v√¶re mindst 10 tegn langt. Du har skrevet ' + goal.length + ' tegn.</p>';
                    return;
                }
                
                submitButton.setAttribute('aria-busy', 'true');
                submitButton.disabled = true;
                resultDiv.innerHTML = '<div class="loading"><progress></progress></div>';

                try {
                    const response = await fetch('/generate-recipe/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ goal: goal })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'HTTP error! status: ' + response.status);
                    }
                    
                    const jsonData = await response.json();
                    renderJsonResponse(jsonData);

                } catch (error) {
                    console.error('Error:', error);
                    resultDiv.innerHTML = '<p style="color: red;"><strong>Fejl:</strong> ' + error.message + '</p>';
                } finally {
                    submitButton.setAttribute('aria-busy', 'false');
                    submitButton.disabled = false;
                }
            });

            // Inspiration prompt handlers
            document.querySelectorAll('.inspiration-prompt').forEach(function(button) {
                console.log('Adding click listener to button:', button.textContent);
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Inspiration prompt clicked:', button.textContent);
                    const prompt = button.getAttribute('data-prompt');
                    console.log('Prompt data:', prompt);
                    goalTextarea.value = prompt;
                    console.log('Textarea value set to:', goalTextarea.value);
                    
                    resultDiv.innerHTML = '<p style="color: green;">‚úì Inspiration prompt indsat: "' + button.textContent + '"</p>';
                });
            });

            function renderJsonResponse(data) {
                let html = '<h4>' + data.title + '</h4>';
                html += '<p><strong>Strategi:</strong> ' + data.strategy_summary + '</p>';

                if (data.creative_approach) {
                    html += '<div class="creative-approach">';
                    html += '<h4>üé® Kreativ Tilgang</h4>';
                    html += '<p>' + data.creative_approach + '</p>';
                    html += '</div>';
                }

                if (data.potential_story_angles && data.potential_story_angles.length > 0) {
                    html += '<div class="potential-story-angles">';
                    html += '<h4>üì∞ Potentielle Historievinkler</h4>';
                    html += '<ul>';
                    data.potential_story_angles.forEach(function(angle) {
                        html += '<li>' + angle + '</li>';
                    });
                    html += '</ul>';
                    html += '</div>';
                }

                if (data.creative_cross_references && data.creative_cross_references.length > 0) {
                    html += '<div class="creative-cross-references">';
                    html += '<h4>üîó Kreative Krydsrefereringer</h4>';
                    html += '<ul>';
                    data.creative_cross_references.forEach(function(ref) {
                        html += '<li>' + ref + '</li>';
                    });
                    html += '</ul>';
                    html += '</div>';
                }

                data.investigation_steps.forEach(function(step) {
                    html += '<div class="step">';
                    html += '<div class="step-header">';
                    html += '<span class="step-number">' + step.step + '</span>';
                    html += '<h5 class="step-title">' + step.title + '</h5>';
                    html += '</div>';
                    html += '<div class="step-details">';
                    
                    if (step.module) {
                        html += '<p><strong>Modul:</strong> <em>' + step.module + '</em></p>';
                    }
                    
                    html += '<p><strong>Form√•l:</strong> ' + step.rationale + '</p>';
                    
                    if (step.details) {
                        if (step.details.strategic_note) {
                            html += '<div class="strategic-note">';
                            html += '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.311a7.5 7.5 0 0 1-7.5 0c-1.421-.492-2.682-1.233-3.654-2.11M12 18.75v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.311a7.5 7.5 0 0 1-7.5 0c-1.421-.492-2.682-1.233-3.654-2.11m-9.58 3.28a13.5 13.5 0 0 1 2.083-1.611m-2.083 1.611a13.5 13.5 0 0 0 2.083-1.611M3.75 6.75A2.25 2.25 0 0 1 6 4.5h12A2.25 2.25 0 0 1 20.25 6.75v10.5A2.25 2.25 0 0 1 18 19.5H6A2.25 2.25 0 0 1 3.75 17.25V6.75Z" /></svg>';
                            html += '<div>' + step.details.strategic_note + '</div>';
                            html += '</div>';
                        }

                        if (step.details.search_string) {
                            html += '<strong>S√∏gestreng:</strong>';
                            html += '<div class="search-string-container">';
                            html += '<button class="copy-btn">Kopi√©r</button>';
                            html += '<pre><code>' + step.details.search_string + '</code></pre>';
                            html += '</div>';
                            html += '<strong>Forklaring:</strong>';
                            html += '<p>' + step.details.explanation + '</p>';
                        }

                        if (step.details.logic) {
                            html += '<strong>Logik:</strong> <p>' + step.details.logic + '</p>';
                        }
                        
                        if (step.details.recommended_notification) {
                            const notificationText = step.details.recommended_notification === 'l√∏bende'
                                ? '<b>L√∏bende notifikation:</b> F√• besked med det samme, n√•r der er nye resultater. Godt til tidskritiske overv√•gninger.'
                                : '<b>Interval notifikation:</b> F√• en samlet besked dagligt eller ugentligt. Godt til mindre presserende overv√•gninger for at undg√• st√∏j.';
                            html += '<div class="notification-recommendation">';
                            html += '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" /></svg>';
                            html += '<div>' + notificationText + '</div>';
                            html += '</div>';
                        }
                        
                        if (step.details.creative_insights) {
                            html += '<div class="creative-insights"><strong>üí° Kreativ Indsigt:</strong> ' + step.details.creative_insights + '</div>';
                        }
                        
                        if (step.details.advanced_tactics) {
                            html += '<div class="advanced-tactics"><strong>üéØ Avancerede Taktikker:</strong> ' + step.details.advanced_tactics + '</div>';
                        }
                        
                        if (step.details.search_examples) {
                            html += '<div class="search-examples"><strong>üîç S√∏ge-eksempler:</strong><ul>';
                            step.details.search_examples.forEach(function(ex) {
                                html += '<li><code>' + ex + '</code></li>';
                            });
                            html += '</ul></div>';
                        }
                        
                        if (step.details.live_data_available) {
                            html += '<div class="live-data-indicator">' + (step.details.data_source || 'Live data tilg√¶ngelig') + '</div>';
                        }
                        if (step.details.geo_advice) {
                            html += '<div class="geo-advice">üåç <strong>Geo-r√•d:</strong> ' + step.details.geo_advice + '</div>';
                        }
                    }
                    
                    html += '</div></div>';
                });

                if (data.next_level_questions && data.next_level_questions.length > 0) {
                    html += '<h4>N√¶ste Niveau</h4><ul>';
                    data.next_level_questions.forEach(function(q) {
                        html += '<li>' + q + '</li>';
                    });
                    html += '</ul>';
                }

                if (data.supplementary_modules && data.supplementary_modules.length > 0) {
                    html += '<h4>Supplerende moduler at overveje</h4><ul class="supplementary-modules">';
                    data.supplementary_modules.forEach(function(mod) {
                        html += '<li><strong>' + mod.module + '</strong>: ' + mod.reason + '</li>';
                    });
                    html += '</ul>';
                }

                if (data.validation_warnings && data.validation_warnings.length > 0) {
                    html += '<h4>‚ö†Ô∏è KM24 Modul Validering</h4>';
                    data.validation_warnings.forEach(function(warning) {
                        html += '<div class="validation-warning">';
                        html += '<p><strong>' + warning.message + '</strong></p>';
                        if (warning.suggestions && warning.suggestions.length > 0) {
                            html += '<p><strong>Forslag til alternative moduler:</strong></p><ul>';
                            warning.suggestions.forEach(function(suggestion) {
                                html += '<li><strong>' + suggestion.module + '</strong> (' + Math.round(suggestion.confidence * 100) + '% match): ' + suggestion.reason + '</li>';
                            });
                            html += '</ul>';
                        }
                        html += '</div>';
                    });
                }

                if (data.km24_module_suggestions && data.km24_module_suggestions.length > 0) {
                    html += '<h4>üîç KM24 Modul Forslag</h4>';
                    html += '<p>Baseret p√• dit m√•l foresl√•r vi f√∏lgende KM24 moduler:</p>';
                    html += '<ul class="km24-suggestions">';
                    data.km24_module_suggestions.forEach(function(suggestion) {
                        html += '<li>';
                        html += '<strong>' + suggestion.module + '</strong> (' + Math.round(suggestion.confidence * 100) + '% relevans)';
                        html += '<br><em>' + suggestion.reason + '</em>';
                        if (suggestion.description) {
                            html += '<br><small>' + suggestion.description + '</small>';
                        }
                        html += '</li>';
                    });
                    html += '</ul>';
                }

                resultDiv.innerHTML = html;
                addCopyFunctionality();
            }

            function addCopyFunctionality() {
                document.querySelectorAll('.copy-btn').forEach(function(button) {
                    button.addEventListener('click', function() {
                        const container = button.closest('.search-string-container');
                        const code = container.querySelector('code');
                        navigator.clipboard.writeText(code.textContent).then(function() {
                            button.textContent = 'Kopieret!';
                            button.classList.add('copied');
                            setTimeout(function() {
                                button.textContent = 'Kopi√©r';
                                button.classList.remove('copied');
                            }, 2000);
                        });
                    });
                });
            }
        });
    </script>
</body>
</html> 